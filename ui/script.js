const successElement=document.getElementById("SUCCESS_CODE"),errorElement=document.getElementById("ERROR_CODE"),keyBlockElement=document.getElementById("KEY_BLOCK"),saveElement=document.getElementById("SAVE_BUTTON");function updateUsageAndLimit(){const e=document.getElementById("USAGE_TEXT"),t=document.getElementById("LIMIT_TEXT");chrome.storage.sync.get(["usage","limit"],(n=>{e.innerText=`${n.usage}`,t.innerText=`${n.limit}`}))}updateUsageAndLimit(),saveElement.addEventListener("click",(()=>{const e=document.getElementById("KEY_FIELD");let t=e.value?e.value.trim():"";if(!t.length)return errorElement.innerText="Please enter a valid license key",void(errorElement.style.display="block");fetch("https://api.gumroad.com/v2/licenses/verify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"product_id=OVuHpojLkMnm0FHbQmMkZQ==&license_key="+t}).then((e=>e.json())).then((e=>{if(!e.success)return void fetch("https://api.gumroad.com/v2/licenses/verify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"product_id=oxuNS385SLje6dghLcn0Ag==&license_key="+t}).then((e=>e.json())).then((e=>{if(e.success){if(e.uses>1)return errorElement.innerText="License key already used",void(errorElement.style.display="block");const t=e.purchase.variants.toLowerCase();let n=0;t.includes("50")?n=50:t.includes("100")?n=100:t.includes("20")&&(n=20),chrome.storage.sync.get(["usage","limit"],(e=>{chrome.storage.sync.set({limit:e.limit+n},(()=>{keyBlockElement.style.display="none",successElement.style.display="block",updateUsageAndLimit()}))}))}else errorElement.innerText="Invalid license key",errorElement.style.display="block"}));if(e.uses>1)return errorElement.innerText="License key already used",void(errorElement.style.display="block");const n=e.purchase,s=n.variants.toLowerCase();let l=0;s.includes("starter")?l=150:s.includes("basic")?l=600:s.includes("professional")&&(l=1500),chrome.storage.sync.set({limit:l,usage:0,licenseKey:t,type:s,saleTimestamp:n.sale_timestamp},(()=>{keyBlockElement.style.display="none",successElement.style.display="block",updateUsageAndLimit()}))}))}));